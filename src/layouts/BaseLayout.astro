---
import '../styles/global.css';
import Nav from '../components/Nav.astro';
import { profile } from '../lib/constants/profile';
import CursorGlow from '../components/CursorGlow';
import ScrollToTop from '../components/ScrollToTop';
import { ViewTransitions } from 'astro:transitions';

const { title, description } = Astro.props;
---
<!doctype html>
<html lang="en" class="noise grid-overlay scroll-smooth">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <script is:inline>
      // Theme init: system default + optional user override (light/dark/system)
      (() => {
        const storageKey = 'theme';
        const mql = window.matchMedia('(prefers-color-scheme: dark)');

        const readPref = () => {
          const v = localStorage.getItem(storageKey);
          return v === 'light' || v === 'dark' || v === 'system' ? v : 'system';
        };

        const resolve = (pref) => {
          if (pref === 'light' || pref === 'dark') return pref;
          return mql.matches ? 'dark' : 'light';
        };

        const apply = (t) => {
          const root = document.documentElement;
          root.classList.toggle('dark', t === 'dark');
          root.dataset.theme = t;
          const meta = document.querySelector('meta[name="theme-color"]');
          if (meta) meta.setAttribute('content', t === 'dark' ? '#020617' : '#ffffff');
        };

        const pref = readPref();
        apply(resolve(pref));

        // Sync with system changes only in system mode
        const onSystem = () => {
          if (readPref() === 'system') apply(resolve('system'));
        };
        try {
          mql.addEventListener('change', onSystem);
        } catch {
          // Safari
          mql.addListener(onSystem);
        }
      })();
    </script>
    <script is:inline>
      (() => {
        const bindSpotlights = () => {
          try {
            const reduce = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
            if (reduce) return;

            const els = Array.from(document.querySelectorAll('[data-spotlight]'));
            if (!els.length) return;

            const rafMap = new WeakMap();

            const onMove = (el, ev) => {
              const r = el.getBoundingClientRect();
              const x = ev.clientX - r.left;
              const y = ev.clientY - r.top;
              el.style.setProperty('--sx', `${x}px`);
              el.style.setProperty('--sy', `${y}px`);
            };

            els.forEach((el) => {
              if (el.dataset.spotlightBound === '1') return;
              el.dataset.spotlightBound = '1';

              const handler = (ev) => {
                const prev = rafMap.get(el);
                if (prev) cancelAnimationFrame(prev);
                rafMap.set(el, requestAnimationFrame(() => onMove(el, ev)));
              };

              el.addEventListener('pointermove', handler);
              el.addEventListener('pointerleave', () => {
                el.style.removeProperty('--sx');
                el.style.removeProperty('--sy');
              });
            });
          } catch {}
        };

        const boot = () => {
          bindSpotlights();
          window.addEventListener('astro:page-load', bindSpotlights);
          window.addEventListener('astro:after-swap', bindSpotlights);
        };

        if (document.readyState === 'loading') {
          window.addEventListener('DOMContentLoaded', boot, { once: true });
        } else {
          boot();
        }
      })();
    </script>


    <ViewTransitions />
    <title>{title}</title>
    {description ? <meta name="description" content={description} /> : null}
    <meta name="theme-color" content="#ffffff" />

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Space+Grotesk:wght@500;600;700&display=swap" rel="stylesheet" />

    <!-- Optional: improves perceived typography (online)...
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
    -->

    <link rel="icon" href="/favicon.svg" />
  </head>
  <body class="relative">
    <a href="#content" class="sr-only focus:not-sr-only focus:fixed focus:left-4 focus:top-4 focus:z-[60] focus:rounded-xl focus:bg-white dark:bg-slate-950 focus:px-4 focus:py-2 focus:text-sm focus:font-semibold focus:text-slate-900 dark:text-slate-50 focus:shadow-soft">Skip to content</a>
    <Nav />
    <CursorGlow client:load />
    <ScrollToTop client:load />
    <main transition:name="main" id="content" class="relative z-10 mx-auto max-w-6xl px-4 pt-16 sm:pt-20 pb-16">
      <slot />
    </main>

    <footer class="border-t border-slate-200 dark:border-slate-800/60 bg-white dark:bg-slate-950/50 dark:bg-slate-950/50 dark:border-slate-800/60 dark:bg-slate-950/30">
      <div class="mx-auto flex max-w-6xl flex-col gap-2 px-4 py-10 text-sm text-slate-600 dark:text-slate-400 dark:text-slate-400 sm:flex-row sm:items-center sm:justify-between">
        <div>© {new Date().getFullYear()} — Built with Astro + React + Framer Motion</div>
                <div class="flex items-center gap-2">
          <a
            class="inline-flex items-center justify-center rounded-full border border-slate-200 bg-white/70 p-2 text-slate-700 shadow-[0_18px_45px_rgba(16,24,40,0.06)] backdrop-blur transition hover:text-slate-900 dark:border-slate-800/60 dark:bg-slate-950/40 dark:text-slate-200 dark:hover:text-slate-50"
            href={profile.links.linkedin}
            target="_blank"
            rel="noreferrer"
            aria-label="LinkedIn"
            title="LinkedIn"
          >
            <svg viewBox="0 0 24 24" class="h-5 w-5" fill="currentColor" aria-hidden="true">
              <path d="M4.98 3.5C4.98 4.88 3.87 6 2.5 6S0 4.88 0 3.5 1.11 1 2.48 1c1.38 0 2.5 1.12 2.5 2.5zM.5 23.5h4V7.98h-4V23.5zM8.5 7.98h3.83v2.12h.05c.53-1 1.83-2.12 3.77-2.12 4.03 0 4.78 2.65 4.78 6.1v9.42h-4v-8.35c0-1.99-.04-4.55-2.77-4.55-2.77 0-3.19 2.16-3.19 4.4v8.5h-4V7.98z"/>
            </svg>
          </a>

          <a
            class="inline-flex items-center justify-center rounded-full border border-slate-200 bg-white/70 p-2 text-slate-700 shadow-[0_18px_45px_rgba(16,24,40,0.06)] backdrop-blur transition hover:text-slate-900 dark:border-slate-800/60 dark:bg-slate-950/40 dark:text-slate-200 dark:hover:text-slate-50"
            href={profile.links.handshake}
            target="_blank"
            rel="noreferrer"
            aria-label="Handshake"
            title="Handshake"
          >
            <svg viewBox="0 0 24 24" class="h-5 w-5" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
              <path d="M7 4v16" />
              <path d="M17 4v16" />
              <path d="M7 12h10" />
            </svg>
          </a>

          <a
            class="inline-flex items-center justify-center rounded-full border border-slate-200 bg-white/70 p-2 text-slate-700 shadow-[0_18px_45px_rgba(16,24,40,0.06)] backdrop-blur transition hover:text-slate-900 dark:border-slate-800/60 dark:bg-slate-950/40 dark:text-slate-200 dark:hover:text-slate-50"
            href={profile.links.github}
            target="_blank"
            rel="noreferrer"
            aria-label="GitHub"
            title="GitHub"
          >
            <svg viewBox="0 0 24 24" class="h-5 w-5" fill="currentColor" aria-hidden="true">
              <path d="M12 0.297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385 0.6 0.113 0.82-0.258 0.82-0.577 0-0.285-0.01-1.04-0.015-2.04 -3.338 0.724-4.042-1.61-4.042-1.61 -0.546-1.387-1.333-1.756-1.333-1.756 -1.09-0.745 0.083-0.73 0.083-0.73 1.205 0.085 1.84 1.24 1.84 1.24 1.07 1.835 2.807 1.305 3.492 0.998 0.108-0.776 0.417-1.305 0.76-1.605 -2.665-0.3-5.466-1.332-5.466-5.93 0-1.31 0.468-2.38 1.236-3.22 -0.123-0.303-0.536-1.523 0.117-3.176 0 0 1.008-0.322 3.3 1.23 0.957-0.266 1.983-0.399 3.003-0.404 1.02 0.005 2.047 0.138 3.006 0.404 2.29-1.552 3.297-1.23 3.297-1.23 0.655 1.653 0.242 2.873 0.12 3.176 0.77 0.84 1.235 1.91 1.235 3.22 0 4.61-2.807 5.625-5.48 5.92 0.43 0.37 0.823 1.103 0.823 2.222 0 1.606-0.015 2.898-0.015 3.293 0 0.32 0.216 0.694 0.825 0.576 4.765-1.58 8.2-6.08 8.2-11.38 0-6.627-5.373-12-12-12z"/>
            </svg>
          </a>
        </div>
      </div>
    </footer>
  </body>
</html>
