---
import BaseLayout from '../../layouts/BaseLayout.astro';
import MotionReveal from '../../components/MotionReveal';
import { profile } from '../../lib/constants/profile';
import { logoForTech } from '../../lib/techLogos';

export async function getStaticPaths() {
  return profile.caseStudies.map((study) => ({
    params: { slug: study.slug },
    props: { study },
  }));
}

const { study } = Astro.props;
const title = `${profile.name} — ${study.title}`;
---

<BaseLayout title={title} description={study.subtitle}>
  <div class="mt-10">
    <div class="flex items-center gap-3 text-sm text-slate-600 dark:text-slate-400">
      <a href="/projects/" class="underline hover:text-slate-900 dark:hover:text-slate-100">Projects</a>
      <span>·</span>
      <span>{study.when ?? 'Case Study'}</span>
    </div>

    <h1 class="mt-3 font-display text-3xl sm:text-5xl font-semibold tracking-tight text-slate-950 dark:text-slate-50 title-glow">
      {study.title}
    </h1>
    <div class="accent-bar"></div>

    <p class="mt-4 max-w-3xl text-slate-700 dark:text-slate-300">
      {study.subtitle}
    </p>

    <div class="mt-5 flex flex-wrap gap-2">
      {study.tags.map((t) => (
        <span class="inline-flex items-center rounded-full border border-slate-200/70 dark:border-slate-800/70 bg-white/70 dark:bg-slate-950/40 px-2.5 py-1 text-[11px] font-medium text-slate-700 dark:text-slate-300">
          {t}
        </span>
      ))}
    </div>
  </div>

  <div class="mt-10 grid grid-cols-1 gap-5 lg:grid-cols-3">
    <div class="lg:col-span-2 flex flex-col gap-5">
      <MotionReveal client:load>
        <section class="card rounded-3xl p-6" data-spotlight>
          <h2 class="font-display text-xl font-semibold tracking-tight text-slate-950 dark:text-slate-50">Overview</h2>
          <p class="mt-2 text-sm text-slate-700 dark:text-slate-300 whitespace-pre-line">
            {study.sections?.overview}
          </p>
        </section>
      </MotionReveal>

      <MotionReveal client:load delay={0.05}>
        <section class="card rounded-3xl p-6" data-spotlight>
          <h2 class="font-display text-xl font-semibold tracking-tight text-slate-950 dark:text-slate-50">Problem</h2>
          <p class="mt-2 text-sm text-slate-700 dark:text-slate-300 whitespace-pre-line">
            {study.sections?.problem}
          </p>
        </section>
      </MotionReveal>

      <MotionReveal client:load delay={0.10}>
        <section class="card rounded-3xl p-6" data-spotlight>
          <h2 class="font-display text-xl font-semibold tracking-tight text-slate-950 dark:text-slate-50">Approach</h2>
          <p class="mt-2 text-sm text-slate-700 dark:text-slate-300 whitespace-pre-line">
            {study.sections?.approach}
          </p>
        </section>
      </MotionReveal>

      {study.sections?.impact && (
        <MotionReveal client:load delay={0.15}>
          <section class="card rounded-3xl p-6" data-spotlight>
            <h2 class="font-display text-xl font-semibold tracking-tight text-slate-950 dark:text-slate-50">Impact</h2>
            <p class="mt-2 text-sm text-slate-700 dark:text-slate-300 whitespace-pre-line">
              {study.sections?.impact}
            </p>
          </section>
        </MotionReveal>
      )}

    </div>

    <div class="flex flex-col gap-5">
          <MotionReveal client:load delay={0.05}>
            <aside class="card rounded-3xl p-6" data-spotlight>
              <div class="text-xs font-semibold uppercase tracking-wider text-slate-500 dark:text-slate-400">Stack</div>
              <div class="mt-3 flex flex-wrap gap-2">
                {study.sections?.stack?.map((s) => (
                  <span class="inline-flex items-center gap-2 rounded-full border border-slate-200/70 dark:border-slate-800/70 bg-white/70 dark:bg-slate-950/40 px-2.5 py-1 text-[11px] font-medium text-slate-700 dark:text-slate-300">
                    <img src={logoForTech(s)} alt="" aria-hidden="true" class="h-4 w-4 shrink-0" loading="lazy" decoding="async" />
                    <span class="whitespace-nowrap leading-none">{s}</span>
                  </span>
                ))}
              </div>
            </aside>
          </MotionReveal>
    
          <MotionReveal client:load delay={0.10}>
            <aside class="card rounded-3xl p-6" data-spotlight>
              <div class="text-xs font-semibold uppercase tracking-wider text-slate-500 dark:text-slate-400">Links</div>
              <div class="mt-3">
                <a
                  href={study.links?.[0]?.href ?? profile.links.github}
                  target="_blank"
                  rel="noreferrer"
                  class="inline-flex w-full items-center justify-center gap-2 rounded-full border border-slate-200 dark:border-slate-800 bg-white/60 dark:bg-slate-950/30 px-5 py-2.5 text-sm font-semibold text-slate-900 dark:text-slate-50 shadow-soft backdrop-blur transition hover:-translate-y-0.5"
                >
                  <svg aria-hidden="true" viewBox="0 0 24 24" class="h-4 w-4">
                    <path fill="currentColor" d="M12 .5C5.73.5.5 5.88.5 12.5c0 5.28 3.44 9.76 8.2 11.34.6.12.82-.27.82-.6 0-.3-.01-1.1-.02-2.15-3.34.76-4.04-1.67-4.04-1.67-.55-1.45-1.34-1.84-1.34-1.84-1.1-.78.08-.77.08-.77 1.22.09 1.86 1.3 1.86 1.3 1.08 1.92 2.84 1.37 3.53 1.05.11-.82.42-1.37.76-1.69-2.66-.31-5.46-1.38-5.46-6.13 0-1.35.46-2.46 1.23-3.33-.12-.31-.53-1.58.12-3.29 0 0 1.01-.33 3.3 1.27.96-.27 1.99-.41 3.01-.41 1.02 0 2.05.14 3.01.41 2.29-1.6 3.3-1.27 3.3-1.27.65 1.71.24 2.98.12 3.29.77.87 1.23 1.98 1.23 3.33 0 4.76-2.8 5.82-5.47 6.13.43.38.81 1.14.81 2.29 0 1.65-.02 2.98-.02 3.39 0 .33.22.73.83.6 4.76-1.58 8.2-6.06 8.2-11.34C23.5 5.88 18.27.5 12 .5z"/>
                  </svg>
                  <span>View on GitHub</span>
                  <span aria-hidden="true">↗</span>
                </a>
              </div>
    </aside>
          </MotionReveal>
      <!-- Gallery section disabled for now (enable for select flagship projects). -->
    </div>
  </div>
</BaseLayout>
